<Window x:Class="WpfApp4.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="To-Do List" Height="600" Width="500">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Панель добавления задачи -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,5">
            <TextBox Width="180" Text="{Binding NewTaskName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0" KeyDown="TextBox_KeyDown"/>
            <ComboBox Width="90" ItemsSource="{Binding Labels}" SelectedItem="{Binding NewTaskLabel, Mode=TwoWay}" Margin="0,0,5,0"/>
            <ComboBox Width="80" ItemsSource="{Binding Priorities}" SelectedItem="{Binding NewTaskPriority, Mode=TwoWay}" Margin="0,0,5,0"/>
            <DatePicker SelectedDate="{Binding NewTaskDeadline, Mode=TwoWay}" Width="120" Margin="0,0,5,0"/>
            <Button Content="Добавить" Command="{Binding AddTaskCommand}" Width="70"/>
        </StackPanel>

        <!-- Панель поиска, фильтрации, сортировки, темы -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,5">
            <TextBox Width="120" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0"/>
            <ComboBox Width="100" ItemsSource="{Binding Filters}" SelectedItem="{Binding SelectedFilter, Mode=TwoWay}" Margin="0,0,5,0"/>
            <ComboBox Width="100" ItemsSource="{Binding SortTypes}" SelectedItem="{Binding SelectedSort, Mode=TwoWay}" Margin="0,0,5,0" SelectionChanged="ComboBox_SelectionChanged"/>
            <Button Content="Сменить тему" Width="100" Margin="0,0,5,0" Click="ToggleTheme_Click"/>
        </StackPanel>

        <!-- Панель управления задачами -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,5">
            <Button Content="Очистить выполненные" Command="{Binding ClearCompletedCommand}" Width="150" Margin="0,0,5,0"/>
            <Button Content="Архивировать выполненные" Command="{Binding ArchiveCompletedCommand}" Width="170" Margin="0,0,5,0"/>
            <Button Content="Экспорт" Command="{Binding ExportCommand}" Width="80" Margin="0,0,5,0"/>
            <Button Content="Импорт" Command="{Binding ImportCommand}" Width="80"/>
        </StackPanel>

        <!-- Прогресс-бар и счетчик -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,5">
            <ProgressBar Value="{Binding CompletedPercent}" Maximum="100" Height="20" Width="200" Margin="0,0,10,0"/>
            <TextBlock FontWeight="Bold" Foreground="#FF666666" VerticalAlignment="Center">
                Осталось: <Run Text="{Binding RemainingCount}"/> задач
            </TextBlock>
        </StackPanel>

        <!-- Список задач -->
        <ListBox Grid.Row="4" ItemsSource="{Binding FilteredTasks}" Margin="0,10,0,0">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border BorderBrush="#DDD" BorderThickness="0,0,0,1" Padding="4">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <CheckBox IsChecked="{Binding IsCompleted}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="14" Margin="0,0,5,0"
                                               Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=False}"/>
                                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                             Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True}"
                                             LostFocus="TaskNameEdit_LostFocus" KeyDown="TaskNameEdit_KeyDown" Width="120"/>
                                    <!-- Метка -->
                                    <Border Background="LightGray" Margin="5,0,0,0" Padding="2,0" CornerRadius="4">
                                        <TextBlock Text="{Binding Label}"/>
                                    </Border>
                                    <!-- Приоритет -->
                                    <TextBlock Text="{Binding TaskPriority}" Margin="5,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                    <!-- Дедлайн -->
                                    <TextBlock Text="Дедлайн: "/>
                                    <TextBlock Text="{Binding Deadline, StringFormat=dd.MM.yyyy}"/>
                                    <!-- Дата создания -->
                                    <TextBlock Text="  Создана: "/>
                                    <TextBlock Text="{Binding CreatedAt, StringFormat=dd.MM.yyyy}"/>
                                    <!-- Дата выполнения -->
                                    <TextBlock Text="  Выполнена: "/>
                                    <TextBlock Text="{Binding CompletedAt, StringFormat=dd.MM.yyyy}"/>
                                </StackPanel>
                            </StackPanel>
                            <Button Grid.Column="2" Content="❌"
                                    Command="{Binding DataContext.DeleteTaskCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                    CommandParameter="{Binding}"
                                    Margin="5,0,0,0" Width="28" Height="28"
                                    Background="#FFF0F0F0" BorderBrush="#FFD0D0D0" Cursor="Hand" ToolTip="Удалить задачу">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" CornerRadius="6" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="1">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Setter Property="Foreground" Value="#FFB00020"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#FFFFE0E0"/>
                                                <Setter Property="BorderBrush" Value="#FFFFB0B0"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <EventSetter Event="MouseDoubleClick" Handler="TaskName_MouseDoubleClick"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#f0f0f0"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </ListBox.ItemContainerStyle>
        </ListBox>
    </Grid>
</Window>